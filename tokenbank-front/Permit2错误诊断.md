# Permit2é”™è¯¯è¯Šæ–­ï¼šExecution Reverted

## ğŸš¨ é”™è¯¯åˆ†æ

ä»ä½ çš„é”™è¯¯ä¿¡æ¯åˆ†æï¼š

### é”™è¯¯ç±»å‹
```
CallExecutionError: Execution reverted for an unknown reason.
Details: execution reverted
```

è¿™è¡¨ç¤ºåˆçº¦æ‰§è¡Œè¿‡ç¨‹ä¸­é‡åˆ°äº†`require`æˆ–`revert`è¯­å¥ï¼Œä½†æ²¡æœ‰æä¾›è¯¦ç»†çš„é”™è¯¯æ¶ˆæ¯ã€‚

### è°ƒç”¨å‚æ•°åˆ†æ
```
Function: depositWithPermit2 (0x5bc68f46)
- amount: 300000000000000000000 (300 tokens)
- nonce: 15
- deadline: 1753626620
- transferDetails.to: 0x130f5C61F53eF8188af01F9a0D0a3C47bf0cAAdc (TokenBank)
- transferDetails.requestedAmount: 300000000000000000000
- signature: 0xcd084b9ba02b763e2da8ea2e39e431dabf5bf023456aa3cb9c0cec19bcf09eeb484da6721d4c9524e0efb39112d5645d072171dfb737a69a4c2ad913d47798671b
```

## ğŸ” å¯èƒ½çš„å¤±è´¥åŸå› 

### 1. **Tokenåœ°å€é…ç½®é”™è¯¯**
- TokenBankåˆçº¦ä¸­é…ç½®çš„tokenåœ°å€ä¸å‰ç«¯ä¸åŒ¹é…
- **æ£€æŸ¥æ–¹æ³•**: æŸ¥çœ‹å‰ç«¯"ğŸ”§ åˆçº¦é…ç½®"åŒºåŸŸçš„"TokenåŒ¹é…"çŠ¶æ€

### 2. **Permit2åœ°å€é…ç½®é”™è¯¯**
- TokenBankåˆçº¦ä¸­é…ç½®çš„permit2åœ°å€ä¸å®é™…Permit2åˆçº¦ä¸åŒ¹é…
- **æ£€æŸ¥æ–¹æ³•**: æŸ¥çœ‹"Permit2åŒ¹é…"çŠ¶æ€

### 3. **Permit2ç­¾åéªŒè¯å¤±è´¥**
- ç­¾åæ ¼å¼é”™è¯¯
- ç­¾åé’ˆå¯¹çš„domainæˆ–messageä¸æ­£ç¡®
- **æœ€å¸¸è§åŸå› **: chainIdä¸åŒ¹é…

### 4. **Nonceé‡å¤ä½¿ç”¨**
- Permit2 nonceå·²ç»è¢«ä½¿ç”¨è¿‡
- **æ£€æŸ¥æ–¹æ³•**: æŸ¥çœ‹bitmapä¸­è¯¥nonceæ˜¯å¦å·²è¢«æ ‡è®°

### 5. **ç”¨æˆ·ä½™é¢ä¸è¶³**
- ç”¨æˆ·çš„tokenä½™é¢ä¸è¶³ä»¥æ”¯ä»˜300ä¸ªtoken
- **æ£€æŸ¥æ–¹æ³•**: ç¡®è®¤é’±åŒ…ä¸­çš„BAPEä½™é¢

### 6. **TokenBankåˆçº¦éƒ¨ç½²é—®é¢˜**
- åˆçº¦å¯èƒ½æ²¡æœ‰æ­£ç¡®éƒ¨ç½²
- æ„é€ å‡½æ•°å‚æ•°å¯èƒ½é”™è¯¯

## ğŸ”§ ç«‹å³æ£€æŸ¥æ­¥éª¤

### æ­¥éª¤1: æ£€æŸ¥å‰ç«¯é…ç½®çŠ¶æ€
åˆ·æ–°é¡µé¢ï¼Œé€‰æ‹©Permit2å­˜æ¬¾ï¼ŒæŸ¥çœ‹"ğŸ”§ åˆçº¦é…ç½®"åŒºåŸŸï¼š

```
åº”è¯¥æ˜¾ç¤ºï¼š
TOKEN: 0xE265E004...08987
TOKENBANK: 0x130f5C61...cAAdc  
PERMIT2: 0x00000000...C78BA3
ä½™é¢: [ä½ çš„ä½™é¢] BAPE | æˆæƒ: âœ…
TokenåŒ¹é…: âœ… | Permit2åŒ¹é…: âœ…
DOMAIN_SEPARATOR: âœ… | Nonces: âœ… | Bitmap: [æ•°å­—]
```

**å¦‚æœçœ‹åˆ°ä»»ä½•âŒï¼Œé‚£å°±æ˜¯é—®é¢˜æ‰€åœ¨ï¼**

### æ­¥éª¤2: éªŒè¯åˆçº¦éƒ¨ç½²
åœ¨Sepolia Etherscanä¸Šæ£€æŸ¥ä½ çš„åˆçº¦ï¼š

1. **æ£€æŸ¥TokenBankåˆçº¦**: https://sepolia.etherscan.io/address/0x130f5C61F53eF8188af01F9a0D0a3C47bf0cAAdc
   - ç¡®è®¤åˆçº¦å·²éªŒè¯
   - æŸ¥çœ‹æ„é€ å‡½æ•°å‚æ•°æ˜¯å¦æ­£ç¡®

2. **æ£€æŸ¥Tokenåˆçº¦**: https://sepolia.etherscan.io/address/0xE265E00480d1d97DAdc98a1DA688e9B016308987
   - ç¡®è®¤è¿™æ˜¯ä¸€ä¸ªEIP2612Token
   - æ£€æŸ¥ä½ çš„ä½™é¢

### æ­¥éª¤3: æ‰‹åŠ¨æµ‹è¯•Tokenæˆæƒ
å¦‚æœåˆçº¦é…ç½®éƒ½æ­£ç¡®ï¼Œæ‰‹åŠ¨æµ‹è¯•Tokençš„approveåŠŸèƒ½ï¼š

```bash
# åœ¨Etherscanä¸Šè°ƒç”¨Tokenåˆçº¦çš„approve
# spender: 0x000000000022D473030F116dDEE9F6B43aC78BA3 (Permit2)
# amount: 1000000000000000000000 (1000 tokens)
```

### æ­¥éª¤4: æ£€æŸ¥åˆçº¦æ—¥å¿—
æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°ï¼Œåº”è¯¥çœ‹åˆ°ï¼š

```
ğŸ”§ å¼€å§‹åˆçº¦é…ç½®éªŒè¯...
ğŸ” éªŒè¯åˆçº¦é…ç½®:
- å‰ç«¯é…ç½®çš„TOKEN_ADDRESS: 0xE265E00480d1d97DAdc98a1DA688e9B016308987
- TokenBankåˆçº¦ä¸­çš„tokenåœ°å€: 0xE265E00480d1d97DAdc98a1DA688e9B016308987
âœ… TOKENåœ°å€åŒ¹é…
âœ… PERMIT2åœ°å€åŒ¹é…
âœ… ç”¨æˆ·æœ‰Tokenä½™é¢: 1000000000000000000000
âœ… ç”¨æˆ·å·²æˆæƒPermit2: 115792089237316195423570985008687907853269984665640564039457584007913129639935
âœ… Tokenæ”¯æŒEIP-2612
âœ… å¯ä»¥è·å–nonces
âœ… æ‰€æœ‰é…ç½®æ£€æŸ¥é€šè¿‡
```

## ğŸš¨ å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

### é—®é¢˜1: TokenåŒ¹é… âŒ
**åŸå› **: TokenBankåˆçº¦éƒ¨ç½²æ—¶ä½¿ç”¨äº†é”™è¯¯çš„tokenåœ°å€
**è§£å†³**: é‡æ–°éƒ¨ç½²TokenBankåˆçº¦ï¼Œä½¿ç”¨æ­£ç¡®çš„tokenåœ°å€

### é—®é¢˜2: Permit2åŒ¹é… âŒ  
**åŸå› **: TokenBankåˆçº¦éƒ¨ç½²æ—¶ä½¿ç”¨äº†é”™è¯¯çš„permit2åœ°å€
**è§£å†³**: é‡æ–°éƒ¨ç½²TokenBankåˆçº¦ï¼Œä½¿ç”¨å®˜æ–¹Permit2åœ°å€

### é—®é¢˜3: ç”¨æˆ·ä½™é¢ä¸º0
**åŸå› **: é’±åŒ…æ²¡æœ‰BAPE token
**è§£å†³**: ä»tokenåˆçº¦owneré‚£é‡Œè·å–ä¸€äº›æµ‹è¯•token

### é—®é¢˜4: æˆæƒçŠ¶æ€ âŒ
**åŸå› **: ç”¨æˆ·æ²¡æœ‰æˆæƒPermit2åˆçº¦
**è§£å†³**: ç‚¹å‡»å­˜æ¬¾æ—¶ä¼šè‡ªåŠ¨æˆæƒ

### é—®é¢˜5: DOMAIN_SEPARATOR âŒ
**åŸå› **: Tokenåˆçº¦ä¸æ”¯æŒEIP-2612
**è§£å†³**: ç¡®è®¤ä½¿ç”¨çš„æ˜¯EIP2612Tokenè€Œä¸æ˜¯æ™®é€šERC20

## ğŸ“‹ å¿«é€Ÿä¿®å¤å‘½ä»¤

å¦‚æœå‘ç°åˆçº¦é…ç½®é—®é¢˜ï¼Œé‡æ–°éƒ¨ç½²ï¼š

```bash
# 1. é‡æ–°éƒ¨ç½²Token (å¦‚æœéœ€è¦)
forge script script/DeployEIP2612Token.s.sol --rpc-url sepolia --broadcast --verify

# 2. é‡æ–°éƒ¨ç½²TokenBankï¼Œç¡®ä¿ä½¿ç”¨æ­£ç¡®çš„åœ°å€
forge script script/TokenBank.s.sol --rpc-url sepolia --broadcast --verify

# 3. æ›´æ–°å‰ç«¯åœ°å€é…ç½®
# åœ¨ tokenbank-front/src/app/page.tsx ä¸­æ›´æ–°ï¼š
# - TOKEN_ADDRESS = "æ–°çš„tokenåœ°å€"
# - TOKENBANK_ADDRESS = "æ–°çš„tokenbankåœ°å€"
```

## ğŸ¯ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **åˆ·æ–°é¡µé¢**ï¼ŒæŸ¥çœ‹é…ç½®çŠ¶æ€
2. **æ£€æŸ¥æ‰€æœ‰âœ…/âŒçŠ¶æ€**
3. **å¦‚æœæœ‰âŒï¼ŒæŒ‰ç…§ä¸Šé¢çš„è§£å†³æ–¹æ¡ˆä¿®å¤**
4. **é‡æ–°æµ‹è¯•Permit2å­˜æ¬¾**

## ğŸ’¡ é¢„é˜²æªæ–½

1. **éƒ¨ç½²æ—¶ä»”ç»†æ£€æŸ¥æ„é€ å‡½æ•°å‚æ•°**
2. **åœ¨Etherscanä¸ŠéªŒè¯åˆçº¦**
3. **åœ¨å‰ç«¯é…ç½®æ­£ç¡®çš„åˆçº¦åœ°å€**
4. **ç¡®ä¿ä½¿ç”¨æ”¯æŒEIP-2612çš„Token**

è¿™æ ·åº”è¯¥èƒ½å¿«é€Ÿå®šä½å¹¶è§£å†³é—®é¢˜ï¼ğŸš€ 